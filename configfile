
# steps to setup the promethes and grafana dashboards

1. Grafana Installation & Configuration

Download & install Grafana:

sudo yum install -y https://dl.grafana.com/grafana/release/12.1.1/grafana_12.1.1_16903967602_linux_amd64.rpm


Enable & start Grafana service:

sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable grafana-server.service
sudo /bin/systemctl start grafana-server.service
sudo /bin/systemctl status grafana-server.service


Access Grafana:

http://<public_ip>:3000
# default user: admin / admin

2. Prometheus Installation & Service Configuration

Download Prometheus:

wget https://github.com/prometheus/prometheus/releases/download/v3.5.0/prometheus-3.5.0.linux-amd64.tar.gz
tar -xvzf prometheus-3.5.0.linux-amd64.tar.gz


Create systemd service file:
/etc/systemd/system/prometheus.service

[Unit]
Description=Prometheus Server
Documentation=https://prometheus.io/docs/introduction/overview/
After=network-online.target

[Service]
User=root
Restart=on-failure
ExecStart=/root/prometheus-3.5.0.linux-amd64/prometheus \
  --config.file=/root/prometheus-3.5.0.linux-amd64/prometheus.yml

[Install]
WantedBy=multi-user.target


Reload systemd & start Prometheus:

sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus


Access Prometheus:

http://<public_ip>:9090

3. Node Exporter Installation & Service Configuration

Download Node Exporter:

wget https://github.com/prometheus/node_exporter/releases/download/v1.9.1/node_exporter-1.9.1.linux-amd64.tar.gz
tar -xvzf node_exporter-1.9.1.linux-amd64.tar.gz


Create systemd service file:
/etc/systemd/system/node_exporter.service

[Unit]
Description=Node Exporter
Documentation=https://prometheus.io/docs/introduction/overview/
After=network-online.target

[Service]
User=root
Restart=on-failure
ExecStart=/root/node_exporter-1.9.1.linux-amd64/node_exporter

[Install]
WantedBy=multi-user.target


Reload systemd & start Node Exporter:

sudo systemctl daemon-reload
sudo systemctl enable node_exporter
sudo systemctl start node_exporter


Access Node Exporter metrics:

http://<server_ip>:9100/metrics

4. Prometheus Configuration (prometheus.yml)

Add Node Exporter & Docker endpoints in /root/prometheus-3.5.0.linux-amd64/prometheus.yml:

global:
  scrape_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "node_exporter"
    static_configs:
      - targets: ["<node_ip>:9100"]

  - job_name: "docker"
    static_configs:
      - targets: ["localhost:9323"]

5. Docker Metrics Configuration

Add metrics config to /etc/docker/daemon.json:

{
  "metrics-addr": "127.0.0.1:9323"
}


Restart Docker:

sudo systemctl restart docker

6. Grafana Dashboard Setup

Login → Configuration → Data Sources → Add Prometheus

URL: http://<prometheus_ip>:9090

Create Dashboard → Add Panels → Use Prometheus queries

Example Query for CPU usage:

sum by(mode) (irate(node_cpu_seconds_total{mode!="idle"}[1m])) > 0


✅ Now you have Prometheus collecting metrics from Node Exporter & Docker, and Grafana visualizing them.
